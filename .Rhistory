casesByCounty <- MD_Counties_Path$getElementAttribute("outerHTML")[[1]] %>% read_html(useInternalNodes = T) %>% html_table(fill = T)
casesByCounty
Sys.sleep(10)
MD_AgeSex_Path <- remDr$findElement(using = 'xpath', value = '/html/body/div[2]/div[5]/div[3]/div/div[1]/div/section[5]/div/div/div[2]/div/div/strong/table')
casesByAgeAndSex <- MD_AgeSex_Path$getElementAttribute("outerHTML")[[1]] %>% read_html(useInternalNodes = T) %>% html_table(fill = T)
casesByAgeAndSex
Sys.sleep(10)
remDr$navigate("http://www.vdh.virginia.gov/coronavirus/")
Sys.sleep(30)
virginiaDownloadLinkCasesByCounty <- remDr$findElement(using = "xpath", value = "/html/body/div[3]/div[2]/div/main/article/div/div/div[2]/div/div/div/div/div/div[1]/div[2]/div/p[1]/a")
Sys.sleep(10)
virginiaDownloadLinkCasesByCountyURL <- virginiaDownloadLinkCasesByCounty$getElementAttribute("href")
Sys.sleep(10)
virginiaDownloadLinkCasesByCountyURL <- unlist(virginiaDownloadLinkCasesByCountyURL)
download.file(virginiaDownloadLinkCasesByCountyURL, destfile = "Virginia_By_County_Today.csv")
Sys.sleep(10)
virginiaDownloadLinkCasesByAge <- remDr$findElement(using = "xpath", value = "/html/body/div[3]/div[2]/div/main/article/div/div/div[2]/div/div/div/div/div/div[1]/div[2]/div/p[2]/a")
Sys.sleep(10)
virginiaDownloadLinkCasesByAgeURL <- virginiaDownloadLinkCasesByAge$getElementAttribute("href")
Sys.sleep(10)
virginiaDownloadLinkCasesByAgeURL <- unlist(virginiaDownloadLinkCasesByAgeURL)
download.file(virginiaDownloadLinkCasesByAgeURL, destfile = "Virginia_By_Age_Today.csv")
Sys.sleep(10)
virginiaDownloadLinkCasesBySex <- remDr$findElement(using = "xpath", value = "/html/body/div[3]/div[2]/div/main/article/div/div/div[2]/div/div/div/div/div/div[1]/div[2]/div/p[3]/a[2]")
Sys.sleep(10)
virginiaDownloadLinkCasesBySexURL <- virginiaDownloadLinkCasesBySex$getElementAttribute("href")
Sys.sleep(10)
virginiaDownloadLinkCasesBySexURL <- unlist(virginiaDownloadLinkCasesBySexURL)
download.file(virginiaDownloadLinkCasesBySexURL, destfile = "Virginia_By_Sex_Today.csv")
Sys.sleep(10)
virginiaDownloadLinkCasesByRace <- remDr$findElement(using = "xpath", value = "/html/body/div[3]/div[2]/div/main/article/div/div/div[2]/div/div/div/div/div/div[1]/div[2]/div/p[4]/a[2]")
Sys.sleep(10)
virginiaDownloadLinkCasesByRaceURL <- virginiaDownloadLinkCasesByRace$getElementAttribute("href")
Sys.sleep(10)
virginiaDownloadLinkCasesByRaceURL <- unlist(virginiaDownloadLinkCasesByRaceURL)
download.file(virginiaDownloadLinkCasesByRaceURL, destfile = "Virginia_By_Race_Today.csv")
Sys.sleep(5)
remDr$close()
Sys.sleep(10)
system("docker stop $(docker ps -a -q)")
system("docker rm $(docker ps -a -q)")
system("docker container prune -f")
system("docker image prune -f")
Sys.sleep(10)
WV_Counties %>%
unlist()
WV_Counties <- WV_Counties %>%
unlist()
WV_Counties %>%
str_replace_all("\\(", "") %>%
str_replace_all("\\)", "") %>%
str_split(", ") %>%
as_tibble("Combined")
WV_CountiesDF <- WV_Counties %>%
str_replace_all("\\(", "") %>%
str_replace_all("\\)", "") %>%
str_split(", ") %>%
as_tibble("Combined")
names(WV_CountiesDF) <- "Combined"
WV_CountiesDFCleaned <- WV_CountiesDF %>%
separate(Combined, into = c("County", "Cases"), sep = " ") %>%
mutate(Cases = as.integer(Cases))
# Adding Date and State Name columns
WV_CountiesDFCleaned$Date <- Sys.Date()
WV_CountiesDFCleaned$State <- "West Virginia"
# Joining in state abbreviation and FIPS code columns
WV_CountiesDFCleaned <- WV_CountiesDFCleaned %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
left_join(countyStateFIPS, by = c("Abbr" = "State", "County" = "Name")) %>%
dplyr::select(County, Cases, Date, State, Abbr, FIPS)
WV_CountiesDFCleaned
WV_Counties <- read_csv("WV_Counties.csv")
WV_Counties <- bind_rows(WV_CountiesDFCleaned, WV_Counties)
write_csv(WV_Counties, "WV_Counties.csv")
casesByCounty <- casesByCounty[[1]]
casesByCounty
colnames(casesByCounty) <- c("County", "Cases")
casesByCounty %>%
separate(col = Cases, into = c("Cases", "Deaths"), sep = ",\\s+") %>%
mutate(Deaths = str_remove_all(Deaths, "[\\(\\)]"))
casesByCounty <- casesByCounty %>%
separate(col = Cases, into = c("Cases", "Deaths"), sep = ",\\s+") %>%
mutate(Deaths = str_remove_all(Deaths, "[\\(\\)]"))
casesByCounty %>%
mutate(Date = Sys.Date(), State = "Maryland", County = str_remove_all(County, "['\\.]"), Cases = as.integer(Cases), Deaths = as.integer(Deaths)) %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
left_join(countyStateFIPS, by = c("Abbr" = "State", "County" = "Name")) %>%
dplyr::select(County, Cases, Deaths, Date, State, Abbr, FIPS)
MD_By_County_Today <- casesByCounty %>%
mutate(Date = Sys.Date(), State = "Maryland", County = str_remove_all(County, "['\\.]"), Cases = as.integer(Cases), Deaths = as.integer(Deaths)) %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
left_join(countyStateFIPS, by = c("Abbr" = "State", "County" = "Name")) %>%
dplyr::select(County, Cases, Deaths, Date, State, Abbr, FIPS)
MD_By_County <- read_csv("MD_By_County.csv")
MD_By_County <- bind_rows(MD_By_County_Today, MD_By_County)
write_csv(MD_By_County, "MD_By_County.csv")
confirmedCasesDeathsHospitalizationsTests %>%
str_split("\n") %>%
lapply(str_remove_all, "Number of ") %>%
lapply(str_remove_all, "ever hospitalized") %>%
lapply(str_remove_all, ",") %>%
as_tibble(.name_repair = "universal") %>%
separate(...1, into = c("Measure", "Amount"), sep = ": ") %>%
mutate(Amount = as.integer(Amount)) %>%
mutate(Date = Sys.Date()) %>%
pivot_wider(names_from = Measure, values_from = Amount) %>%
mutate(Cases = `Confirmed Cases`, Tests = `negative test results`, State = "Maryland") %>%
mutate(Tests = sum(Tests, sum(MD_By_County_Today$Cases))) %>%
select(Tests, Deaths, Hospitalizations, Date, State)
MD_Summary_Today <- confirmedCasesDeathsHospitalizationsTests %>%
str_split("\n") %>%
lapply(str_remove_all, "Number of ") %>%
lapply(str_remove_all, "ever hospitalized") %>%
lapply(str_remove_all, ",") %>%
as_tibble(.name_repair = "universal") %>%
separate(...1, into = c("Measure", "Amount"), sep = ": ") %>%
mutate(Amount = as.integer(Amount)) %>%
mutate(Date = Sys.Date()) %>%
pivot_wider(names_from = Measure, values_from = Amount) %>%
mutate(Cases = `Confirmed Cases`, Tests = `negative test results`, State = "Maryland") %>%
mutate(Tests = sum(Tests, sum(MD_By_County_Today$Cases))) %>%
select(Tests, Deaths, Hospitalizations, Date, State)
MD_Summary <- read_csv("MD_Summary.csv")
MD_Summary <- bind_rows(MD_Summary_Today, MD_Summary)
write_csv(MD_Summary, "MD_Summary.csv")
casesByAgeAndSex <- casesByAgeAndSex[[1]]
MD_By_Sex_Today <- casesByAgeAndSex[10,1]
MD_By_Sex_Today <- MD_By_Sex_Today %>%
str_remove_all("[,:]") %>%
str_split("\\s+")
MD_By_Sex_Today
tibble(Sex = c(MD_By_Sex_Today[[1]][1], MD_By_Sex_Today[[1]][3]),
Cases = as.integer(c(MD_By_Sex_Today[[1]][2], MD_By_Sex_Today[[1]][4])),
Date = as.Date(rep(Sys.Date(), 2)),
State = rep("Maryland", 2))
MD_By_Sex_Today <- tibble(Sex = c(MD_By_Sex_Today[[1]][1], MD_By_Sex_Today[[1]][3]),
Cases = as.integer(c(MD_By_Sex_Today[[1]][2], MD_By_Sex_Today[[1]][4])),
Date = as.Date(rep(Sys.Date(), 2)),
State = rep("Maryland", 2))
MD_By_Sex <- read_csv("MD_By_Sex.csv")
MD_By_Sex <- bind_rows(MD_By_Sex_Today, MD_By_Sex)
write_csv(MD_By_Sex, "MD_By_Sex.csv")
MD_By_Sex
MD_By_Age_Today <- casesByAgeAndSex[1:9,]
colnames(MD_By_Age_Today) <- c("Age_Range", "Cases")
MD_By_Age_Today <- MD_By_Age_Today %>%
mutate(Date = Sys.Date(), State = "Maryland", Cases = as.integer(Cases))
MD_By_Age_Today
MD_By_Age <- read_csv("MD_By_Age.csv")
MD_By_Age <- bind_rows(MD_By_Age_Today, MD_By_Age)
write_csv(MD_By_Age, "MD_By_Age.csv")
MD_By_Age
Virginia_By_County_Today <- read_csv("Virginia_By_County_Today.csv", locale = locale(encoding = "UTF-8"))
Virginia_By_County_Today <- Virginia_By_County_Today %>%
rename(County = Locality, Date = `Report Date`, Cases = `Total Cases`) %>%
mutate(State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
dplyr::select(County, Cases, Date, State, Abbr, FIPS)
Virginia_By_County_Today
Virginia_By_County <- read_csv("Virginia_By_County.csv")
Virginia_By_County <- bind_rows(Virginia_By_County_Today, Virginia_By_County)
write_csv(Virginia_By_County, "Virginia_By_County.csv")
Virginia_By_Age_Today <- read_csv("Virginia_By_Age_Today.csv")
# Clean up today's Virginia Age data and add in state column
Virginia_By_Age_Today <- Virginia_By_Age_Today %>%
mutate(Date = `Report Date`, Age_Range = `Age Group`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Age_Range, Cases, Date, State)
Virginia_By_Age <- read_csv("Virginia_By_Age.csv")
bind_rows(Virginia_By_Age_Today, Virginia_By_Age)
Virginia_By_Age <- bind_rows(Virginia_By_Age_Today, Virginia_By_Age)
write_csv(Virginia_By_Age, "Virginia_By_Age.csv")
Virginia_By_Sex_Today <- read_csv("Virginia_By_Sex_Today.csv")
Virginia_By_Sex_Today <- Virginia_By_Sex_Today %>%
mutate(Date = `Report Date`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Sex, Cases, Date, State)
Virginia_By_Sex_Today
Virginia_By_Sex <- read_csv("Virginia_By_Sex.csv")
Virginia_By_Sex <- bind_rows(Virginia_By_Sex_Today, Virginia_By_Sex)
write_csv(Virginia_By_Sex, "Virginia_By_Sex.csv")
Virginia_By_Sex
Virginia_By_Race_Today <- read_csv("Virginia_By_Race_Today.csv")
Virginia_By_Race_Today <- Virginia_By_Race_Today %>%
mutate(Date = `Report Date`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Race, Cases, Date, State)
Virginia_By_Race <- read_csv("Virginia_By_Race.csv")
bind_rows(Virginia_By_Race_Today, Virginia_By_Race)
Virginia_By_Race <- bind_rows(Virginia_By_Race_Today, Virginia_By_Race)
write_csv(Virginia_By_Race, "Virginia_By_Race.csv")
Virginia_Totals_Numbers <- pdf_text(paste0(paste("Virginia", "COVID-19", "Dashboard", Sys.Date(), sep = " "), ".pdf")) %>%
str_remove_all("\n") %>%
str_remove_all(",") %>%
str_remove_all("(\\s{1,})") %>%
str_extract_all("\\d+") %>%
unlist()
Virginia_Totals_Headers <- pdf_text(paste0(paste("Virginia", "COVID-19", "Dashboard", Sys.Date(), sep = " "), ".pdf")) %>%
str_remove_all("\n") %>%
str_remove_all(",") %>%
str_remove_all("(\\s{1,})") %>%
str_remove_all("Total") %>%
str_extract_all("[[:alpha:]]+") %>%
unlist()
Virginia_Totals_Numbers
Virginia_Totals_Headers
Virginia_Totals_Headers[1] <- "Tests"
Virginia_Totals <- as.data.frame(rbind(Virginia_Totals_Headers, Virginia_Totals_Numbers), row.names = F, stringsAsFactors = F)
Virginia_Totals <- Virginia_Totals[2,]
colnames(Virginia_Totals) <- Virginia_Totals_Headers
Virginia_Totals$Date <- Sys.Date()
Virginia_Totals$Tests <- as.integer(Virginia_Totals$Tests)
Virginia_Totals$Hospitalizations <- as.integer(Virginia_Totals$Hospitalizations)
Virginia_Totals$Deaths <- as.integer(Virginia_Totals$Deaths)
Virginia_Totals$State <- "Virginia"
# Add topline totals into main file
Virginia_Totals_Today <- Virginia_Totals
Virginia_Totals_Today
Virginia_Totals <- read_csv("VirginiaTotals.csv")
Virginia_Totals <- bind_rows(Virginia_Totals_Today, Virginia_Totals)
write_csv(Virginia_Totals, "VirginiaTotals.csv")
Virginia_Totals
library(rvest)
library(htmltools)
library(htmlwidgets)
library(RColorBrewer)
library(xml2)
library(curl)
library(httr)
library(splashr)
library(stevedore)
library(rlist)
library(lubridate)
library(RSelenium)
library(wdman)
library(devtools)
library(pdftools)
library(sf)
library(raster)
library(sp)
library(rgdal)
library(leaflet)
library(plotly)
library(mapview)
library(readxl)
library(scales)
library(tidyverse)
setwd("/home/adrian/Documents/DCist_Covid-19_Analysis")
# Import and make conversion tables first
stateConversions <- tibble(Full_Name = state.name, Abbr = state.abb)
stateConversions <- bind_rows(stateConversions, tibble(Full_Name = "District of Columbia", Abbr = "DC")) %>%
arrange(Full_Name)
countyStateFIPS <- read_csv("countyFIPSCodes2019.csv")
countyStateFIPS <- bind_rows(countyStateFIPS, tibble(FIPS = 11001, Name = "District of Columbia", State = "DC"))
stateCountyPops <- read_csv("/home/adrian/Documents/US_County_Shapfile_Population/co-est2019-alldata.csv", col_types = cols_only(SUMLEV = "c", STATE = "c", COUNTY = "c", STNAME = "c", CTYNAME = "c", POPESTIMATE2019 = "n"))
stateCountyPops <- stateCountyPops %>%
mutate(FIPS = str_c(STATE, COUNTY), TOTAL_POP = POPESTIMATE2019, TOTAL_POP_100K = POPESTIMATE2019 / 100000)
Sys.sleep(10)
system('docker pull selenium/standalone-firefox')
Sys.sleep(10)
system('docker run -t -d -p 4445:4444 --memory 1024mb --shm-size 2g selenium/standalone-firefox')
Sys.sleep(10)
remDr <- remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "firefox")
Sys.sleep(10)
remDr$open()
Sys.sleep(10)
remDr$navigate("https://dhhr.wv.gov/COVID-19/Pages/default.aspx")
Sys.sleep(15)
WV_powerbi <- remDr$findElement(using = 'xpath', value = '/html/body/form/div[7]/div/div[1]/div/div[2]/div/iframe')
WV_powerbiurl <- WV_powerbi$getElementAttribute("src") # Doing this because the powerbi site is scrapable but the WV health one is not.
WV_powerbiurl <- unlist(WV_powerbiurl)
Sys.sleep(10)
remDr$navigate(WV_powerbiurl)
Sys.sleep(30)
WV_Counties <- remDr$findElement(using = 'xpath', value = '/html/body/div[1]/ui-view/div/div[1]/div/div/div/div/exploration-container/exploration-container-legacy/div/div/exploration-host/div/div/exploration/div/explore-canvas-modern/div/div[2]/div/div[2]/div[2]/visual-container-repeat/visual-container-modern[10]/transform/div/div[3]/visual-modern/div/div/div/p/span[2]')
WV_Counties <- WV_Counties$getElementText()
WV_powerbiurl
WV_Counties <- remDr$findElement(using = 'xpath', value = '/html/body/div[1]/ui-view/div/div[1]/div/div/div/div/exploration-container/exploration-container-legacy/div/div/exploration-host/div/div/exploration/div/explore-canvas-modern/div/div[2]/div/div[2]/div[2]/visual-container-repeat/visual-container-modern[11]/transform/div/div[3]/visual-modern/div/div/div/p/span[2]')
WV_Counties <- WV_Counties$getElementText()
WV_Counties
Sys.sleep(10)
# Get the Maryland topline Deaths, Tests, and Hospitalizations data
# The by-county breakout cases data
# and the sex/age breakout cases data
remDr$navigate("https://coronavirus.maryland.gov/")
Sys.sleep(30)
### Maryland Scraping
# MD_Counties <- remDr$findElements(using = 'class', value = 'topBoxH1Text')
# Sys.sleep(10)
MD_Deaths_Hospitalizations_Tests <- remDr$findElement(using = 'xpath', value = '/html/body/div[2]/div[5]/div[3]/div/div[1]/div/section[5]/div/div/div[2]/div/div/p[1]')
confirmedCasesDeathsHospitalizationsTests <- MD_Deaths_Hospitalizations_Tests$getElementText()
confirmedCasesDeathsHospitalizationsTests
Sys.sleep(10)
# confirmedCasesAndDeaths <- CC_D()
# CNTY_C <- MD_Counties[[2]]$getElementText
# casesByCounty <- CNTY_C()
MD_Counties_Path <- remDr$findElement(using = 'xpath', value = '/html/body/div[2]/div[5]/div[3]/div/div[1]/div/section[5]/div/div/div[2]/div/div/table')
casesByCounty <- MD_Counties_Path$getElementAttribute("outerHTML")[[1]] %>% read_html(useInternalNodes = T) %>% html_table(fill = T)
# casesByCounty <- MD_Counties_Path$getElementText()
# dcCovid19ByAgeSexToday <- dcCovid19ByAgeSexTodayHTML$getElementAttribute("outerHTML")[[1]] %>% read_html(useInternalNodes = T) %>% html_table(fill = T)
Sys.sleep(10)
MD_AgeSex_Path <- remDr$findElement(using = 'xpath', value = '/html/body/div[2]/div[5]/div[3]/div/div[1]/div/section[5]/div/div/div[2]/div/div/strong/table')
casesByAgeAndSex <- MD_AgeSex_Path$getElementAttribute("outerHTML")[[1]] %>% read_html(useInternalNodes = T) %>% html_table(fill = T)
casesByCounty
casesByAgeAndSex
confirmedCasesDeathsHospitalizationsTests
Sys.sleep(10)
remDr$navigate("http://www.vdh.virginia.gov/coronavirus/")
Sys.sleep(30)
virginiaDownloadLinkCasesByCounty <- remDr$findElement(using = "xpath", value = "/html/body/div[3]/div[2]/div/main/article/div/div/div[2]/div/div/div/div/div/div[1]/div[2]/div/p[1]/a")
Sys.sleep(10)
virginiaDownloadLinkCasesByCountyURL <- virginiaDownloadLinkCasesByCounty$getElementAttribute("href")
Sys.sleep(10)
virginiaDownloadLinkCasesByCountyURL <- unlist(virginiaDownloadLinkCasesByCountyURL)
download.file(virginiaDownloadLinkCasesByCountyURL, destfile = "Virginia_By_County_Today.csv")
Sys.sleep(10)
virginiaDownloadLinkCasesByAge <- remDr$findElement(using = "xpath", value = "/html/body/div[3]/div[2]/div/main/article/div/div/div[2]/div/div/div/div/div/div[1]/div[2]/div/p[2]/a")
Sys.sleep(10)
virginiaDownloadLinkCasesByAgeURL <- virginiaDownloadLinkCasesByAge$getElementAttribute("href")
Sys.sleep(10)
virginiaDownloadLinkCasesByAgeURL <- unlist(virginiaDownloadLinkCasesByAgeURL)
download.file(virginiaDownloadLinkCasesByAgeURL, destfile = "Virginia_By_Age_Today.csv")
Sys.sleep(10)
virginiaDownloadLinkCasesBySex <- remDr$findElement(using = "xpath", value = "/html/body/div[3]/div[2]/div/main/article/div/div/div[2]/div/div/div/div/div/div[1]/div[2]/div/p[3]/a[2]")
Sys.sleep(10)
virginiaDownloadLinkCasesBySexURL <- virginiaDownloadLinkCasesBySex$getElementAttribute("href")
Sys.sleep(10)
virginiaDownloadLinkCasesBySexURL <- unlist(virginiaDownloadLinkCasesBySexURL)
download.file(virginiaDownloadLinkCasesBySexURL, destfile = "Virginia_By_Sex_Today.csv")
Sys.sleep(10)
virginiaDownloadLinkCasesByRace <- remDr$findElement(using = "xpath", value = "/html/body/div[3]/div[2]/div/main/article/div/div/div[2]/div/div/div/div/div/div[1]/div[2]/div/p[4]/a[2]")
Sys.sleep(10)
virginiaDownloadLinkCasesByRaceURL <- virginiaDownloadLinkCasesByRace$getElementAttribute("href")
Sys.sleep(10)
virginiaDownloadLinkCasesByRaceURL <- unlist(virginiaDownloadLinkCasesByRaceURL)
download.file(virginiaDownloadLinkCasesByRaceURL, destfile = "Virginia_By_Race_Today.csv")
Sys.sleep(5)
remDr$close()
Sys.sleep(10)
system("docker stop $(docker ps -a -q)")
system("docker rm $(docker ps -a -q)")
system("docker container prune -f")
system("docker image prune -f")
Sys.sleep(10)
WV_Counties <- WV_Counties %>%
unlist()
WV_Counties
WV_CountiesDF <- WV_Counties %>%
str_replace_all("\\(", "") %>%
str_replace_all("\\)", "") %>%
str_split(", ") %>%
as_tibble("Combined")
names(WV_CountiesDF) <- "Combined"
WV_CountiesDFCleaned <- WV_CountiesDF %>%
separate(Combined, into = c("County", "Cases"), sep = " ") %>%
mutate(Cases = as.integer(Cases))
# Adding Date and State Name columns
WV_CountiesDFCleaned$Date <- Sys.Date()
WV_CountiesDFCleaned$State <- "West Virginia"
# Joining in state abbreviation and FIPS code columns
WV_CountiesDFCleaned <- WV_CountiesDFCleaned %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
left_join(countyStateFIPS, by = c("Abbr" = "State", "County" = "Name")) %>%
dplyr::select(County, Cases, Date, State, Abbr, FIPS)
WV_CountiesDFCleaned
WV_Counties <- read_csv("WV_Counties.csv")
WV_Counties <- bind_rows(WV_CountiesDFCleaned, WV_Counties)
write_csv(WV_Counties, "WV_Counties.csv")
casesByCounty <- casesByCounty[[1]]
colnames(casesByCounty) <- c("County", "Cases")
casesByCounty <- casesByCounty %>%
separate(col = Cases, into = c("Cases", "Deaths"), sep = ",\\s+") %>%
mutate(Deaths = str_remove_all(Deaths, "[\\(\\)]"))
MD_By_County_Today <- casesByCounty %>%
mutate(Date = Sys.Date(), State = "Maryland", County = str_remove_all(County, "['\\.]"), Cases = as.integer(Cases), Deaths = as.integer(Deaths)) %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
left_join(countyStateFIPS, by = c("Abbr" = "State", "County" = "Name")) %>%
dplyr::select(County, Cases, Deaths, Date, State, Abbr, FIPS)
MD_By_County_Today
MD_By_County <- read_csv("MD_By_County.csv")
MD_By_County <- bind_rows(MD_By_County_Today, MD_By_County)
write_csv(MD_By_County, "MD_By_County.csv")
confirmedCasesDeathsHospitalizationsTests %>%
str_split("\n") %>%
lapply(str_remove_all, "Number of ") %>%
lapply(str_remove_all, "ever hospitalized") %>%
lapply(str_remove_all, ",") %>%
as_tibble(.name_repair = "universal") %>%
separate(...1, into = c("Measure", "Amount"), sep = ": ") %>%
mutate(Amount = as.integer(Amount)) %>%
mutate(Date = Sys.Date()) %>%
pivot_wider(names_from = Measure, values_from = Amount) %>%
mutate(Cases = `Confirmed Cases`, Tests = `negative test results`, State = "Maryland") %>%
mutate(Tests = sum(Tests, sum(MD_By_County_Today$Cases))) %>%
select(Tests, Deaths, Hospitalizations, Date, State)
MD_Summary_Today <- confirmedCasesDeathsHospitalizationsTests %>%
str_split("\n") %>%
lapply(str_remove_all, "Number of ") %>%
lapply(str_remove_all, "ever hospitalized") %>%
lapply(str_remove_all, ",") %>%
as_tibble(.name_repair = "universal") %>%
separate(...1, into = c("Measure", "Amount"), sep = ": ") %>%
mutate(Amount = as.integer(Amount)) %>%
mutate(Date = Sys.Date()) %>%
pivot_wider(names_from = Measure, values_from = Amount) %>%
mutate(Cases = `Confirmed Cases`, Tests = `negative test results`, State = "Maryland") %>%
mutate(Tests = sum(Tests, sum(MD_By_County_Today$Cases))) %>%
select(Tests, Deaths, Hospitalizations, Date, State)
MD_Summary <- read_csv("MD_Summary.csv")
MD_Summary <- bind_rows(MD_Summary_Today, MD_Summary)
write_csv(MD_Summary, "MD_Summary.csv")
casesByAgeAndSex <- casesByAgeAndSex[[1]]
MD_By_Sex_Today <- casesByAgeAndSex[10,1]
MD_By_Sex_Today <- MD_By_Sex_Today %>%
str_remove_all("[,:]") %>%
str_split("\\s+")
MD_By_Sex_Today <- tibble(Sex = c(MD_By_Sex_Today[[1]][1], MD_By_Sex_Today[[1]][3]),
Cases = as.integer(c(MD_By_Sex_Today[[1]][2], MD_By_Sex_Today[[1]][4])),
Date = as.Date(rep(Sys.Date(), 2)),
State = rep("Maryland", 2))
MD_By_Sex_Today
MD_By_Sex <- read_csv("MD_By_Sex.csv")
MD_By_Sex <- bind_rows(MD_By_Sex_Today, MD_By_Sex)
write_csv(MD_By_Sex, "MD_By_Sex.csv")
MD_By_Age_Today <- casesByAgeAndSex[1:9,]
MD_By_Age_Today
colnames(MD_By_Age_Today) <- c("Age_Range", "Cases")
MD_By_Age_Today %>%
mutate(Date = Sys.Date(), State = "Maryland", Cases = as.integer(Cases))
MD_By_Age_Today <- MD_By_Age_Today %>%
mutate(Date = Sys.Date(), State = "Maryland", Cases = as.integer(Cases))
MD_By_Age <- read_csv("MD_By_Age.csv")
MD_By_Age <- bind_rows(MD_By_Age_Today, MD_By_Age)
write_csv(MD_By_Age, "MD_By_Age.csv")
Virginia_By_County_Today <- read_csv("Virginia_By_County_Today.csv", locale = locale(encoding = "UTF-8"))
Virginia_By_County_Today %>%
rename(County = Locality, Date = `Report Date`, Cases = `Total Cases`) %>%
mutate(State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
dplyr::select(County, Cases, Date, State, Abbr, FIPS)
Virginia_By_County_Today <- Virginia_By_County_Today %>%
rename(County = Locality, Date = `Report Date`, Cases = `Total Cases`) %>%
mutate(State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
dplyr::select(County, Cases, Date, State, Abbr, FIPS)
Virginia_By_County <- read_csv("Virginia_By_County.csv")
Virginia_By_County <- bind_rows(Virginia_By_County_Today, Virginia_By_County)
write_csv(Virginia_By_County, "Virginia_By_County.csv")
Virginia_By_Age_Today <- read_csv("Virginia_By_Age_Today.csv")
# Clean up today's Virginia Age data and add in state column
Virginia_By_Age_Today <- Virginia_By_Age_Today %>%
mutate(Date = `Report Date`, Age_Range = `Age Group`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Age_Range, Cases, Date, State)
# Add today's data into main file.
Virginia_By_Age <- read_csv("Virginia_By_Age.csv")
Virginia_By_Age <- bind_rows(Virginia_By_Age_Today, Virginia_By_Age)
write_csv(Virginia_By_Age, "Virginia_By_Age.csv")
Virginia_By_Age
Virginia_By_Sex_Today <- read_csv("Virginia_By_Sex_Today.csv")
Virginia_By_Sex_Today <- Virginia_By_Sex_Today %>%
mutate(Date = `Report Date`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Sex, Cases, Date, State)
# Add today's data into the main file
Virginia_By_Sex <- read_csv("Virginia_By_Sex.csv")
Virginia_By_Sex <- bind_rows(Virginia_By_Sex_Today, Virginia_By_Sex)
write_csv(Virginia_By_Sex, "Virginia_By_Sex.csv")
Virginia_By_Sex
Virginia_By_Race_Today <- read_csv("Virginia_By_Race_Today.csv")
Virginia_By_Race_Today <- Virginia_By_Race_Today %>%
mutate(Date = `Report Date`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Race, Cases, Date, State)
# Add today's data into the main file
Virginia_By_Race <- read_csv("Virginia_By_Race.csv")
Virginia_By_Race <- bind_rows(Virginia_By_Race_Today, Virginia_By_Race)
write_csv(Virginia_By_Race, "Virginia_By_Race.csv")
Virginia_By_Race
Virginia_Totals_Numbers <- pdf_text(paste0(paste("Virginia", "COVID-19", "Dashboard", Sys.Date(), sep = " "), ".pdf")) %>%
str_remove_all("\n") %>%
str_remove_all(",") %>%
str_remove_all("(\\s{1,})") %>%
str_extract_all("\\d+") %>%
unlist()
Virginia_Totals_Headers <- pdf_text(paste0(paste("Virginia", "COVID-19", "Dashboard", Sys.Date(), sep = " "), ".pdf")) %>%
str_remove_all("\n") %>%
str_remove_all(",") %>%
str_remove_all("(\\s{1,})") %>%
str_remove_all("Total") %>%
str_extract_all("[[:alpha:]]+") %>%
unlist()
Virginia_Totals_Numbers
Virginia_Totals_Headers
Virginia_Totals_Headers[1] <- "Tests"
Virginia_Totals <- as.data.frame(rbind(Virginia_Totals_Headers, Virginia_Totals_Numbers), row.names = F, stringsAsFactors = F)
Virginia_Totals <- Virginia_Totals[2,]
colnames(Virginia_Totals) <- Virginia_Totals_Headers
Virginia_Totals$Date <- Sys.Date()
Virginia_Totals$Tests <- as.integer(Virginia_Totals$Tests)
Virginia_Totals$Hospitalizations <- as.integer(Virginia_Totals$Hospitalizations)
Virginia_Totals$Deaths <- as.integer(Virginia_Totals$Deaths)
Virginia_Totals$State <- "Virginia"
# Add topline totals into main file
Virginia_Totals_Today <- Virginia_Totals
Virginia_Totals <- read_csv("VirginiaTotals.csv")
Virginia_Totals <- bind_rows(Virginia_Totals_Today, Virginia_Totals)
write_csv(Virginia_Totals, "VirginiaTotals.csv")
Virginia_Totals
